<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Items Manager</title>

  <!-- Vue -->
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <!-- CSS -->
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="app">
    <!-- Header -->
    <header class="header">
      <div class="header-content">
        <h1>ğŸ“‹ Items Manager</h1>
        <button
          type="button"
          @click="toggleDarkMode"
          class="theme-toggle"
          :title="darkMode ? 'Switch to Light Mode' : 'Switch to Dark Mode'"
        >
          {{ darkMode ? "â˜€ï¸" : "ğŸŒ™" }}
        </button>
      </div>
    </header>

    <!-- Main Content -->
    <main class="container">
      <!-- Error banner -->
      <div v-if="error" class="error-banner" role="alert" aria-live="assertive">{{ error }}</div>

      <!-- Add Item Form -->
      <section class="form-section">
        <form class="form" @submit.prevent="addItem" aria-label="Add item form">
          <div class="form-group">
            <input
              v-model="newItem"
              type="text"
              placeholder="What's on your mind?"
              class="form-input"
              aria-label="New item name"
            />
            <button class="btn btn-primary" type="submit" :disabled="loading || !newItem.trim()" aria-disabled="loading || !newItem.trim()">
              <span v-if="loading && action === 'add'" class="spinner" aria-hidden="true"></span>
              <span v-if="!loading || action !== 'add'">â• Add</span>
              <span v-else>Adding...</span>
            </button>
          </div>
        </form>
      </section>

      <!-- Items List -->
      <section class="items-section">
        <!-- Skeleton loader when loading and no items loaded yet -->
        <div v-if="loading && items.length === 0" class="skeleton-list" aria-hidden="true">
          <div class="skeleton-card" v-for="n in 3" :key="n"></div>
        </div>

        <!-- Empty State -->
        <div v-else-if="!loading && items.length === 0" class="empty-state">
          <p>âœ¨ No items yet. Start by adding one above!</p>
        </div>

        <!-- Items List -->
        <ul v-else class="items-list">
          <li v-for="item in items" :key="item.id" class="item-card" :aria-label="`Item ${item.name}`">
            <div class="item-content">
              <span v-if="editId !== item.id" class="item-text">{{ item.name }}</span>
              <input
                v-else
                v-model="editName"
                type="text"
                class="item-edit-input"
                @keyup.enter="updateItem(item.id)"
                @keyup.escape="cancelEdit"
                aria-label="Edit item name"
              />
            </div>

            <div class="item-actions">
              <button
                v-if="editId !== item.id"
                class="btn btn-secondary"
                @click="startEdit(item)"
                title="Edit item"
                :disabled="loading"
              >
                âœï¸ Edit
              </button>

              <button
                v-else
                class="btn btn-primary"
                @click="updateItem(item.id)"
                title="Save changes"
                :disabled="loading"
              >
                <span v-if="loading && action === 'edit'" class="spinner" aria-hidden="true"></span>
                <span v-if="!loading || action !== 'edit'">ğŸ’¾ Save</span>
                <span v-else>Saving...</span>
              </button>

              <button
                class="btn btn-danger"
                @click="deleteItem(item.id)"
                title="Delete item"
                :disabled="deletingId === item.id"
              >
                <span v-if="deletingId === item.id" class="spinner" aria-hidden="true"></span>
                <span v-if="deletingId !== item.id">ğŸ—‘ï¸ Delete</span>
                <span v-else>Deleting...</span>
              </button>
            </div>
          </li>
        </ul>
      </section>

      <!-- Stats Footer -->
      <footer class="stats-footer" v-if="items.length > 0">
        <p>Total items: <strong>{{ items.length }}</strong></p>
      </footer>
    </main>
  </div>

  <script src="/js/app.js"></script>
</body>

</html>